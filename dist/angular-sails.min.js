!function(e,t){"use strict";e.module("ngSails",["ng"]),function(e,t){function o(t){var o,r,s,i={};return t?(e.forEach(t.split("\n"),function(e){s=e.indexOf(":"),o=lowercase(n(e.substr(0,s))),r=n(e.substr(s+1)),o&&(i[o]=i[o]?i[o]+", "+r:r)}),i):i}function n(t){return e.isString(t)?t.trim():t}function r(t){return t&&e.isFunction(t.then)}function s(t){var n=e.isObject(t)?t:void 0;return function(e){if(n||(n=o(t)),e){var r=n[lowercase(e)];return void 0===r&&(r=null),r}return n}}t.sails.autoConnect=!1,e.module("ngSails").provider("$sails",function(){var o=this;this.httpVerbs=["get","post","put","delete"],this.eventNames=["on","off","once"],this.url=void 0,this.socket=null,this.urlPrefix="",this.config={transports:["websocket","polling"],useCORSRouteToGetCookie:!1},this.debug=!1;var n=this.interceptors=[];this.$get=["$q","$injector","$rootScope","$log","$timeout",function(i,u,c,a,d){function f(e){function t(){n(null)}function n(t,n){n||(n={body:t,headers:t.headers||{},statusCode:t.statusCode||t.status||0,error:function(){return this.statusCode<200||this.statusCode>=400?this.body||this.statusCode:void 0}()}),n.data=n.body,n.status=n.statusCode,n.socket=g,n.url=e.url,n.method=e.method,n.config=e.config,n.error?(o.debug&&a.warn("$sails response "+n.statusCode+" "+e.url,n),s.reject(n)):(o.debug&&a.info("$sails response "+e.url,n),s.resolve(n))}var s=i.defer();return o.debug&&a.info("$sails "+e.method+" "+e.url,e.data||""),e.timeout>0?d(t,e.timeout):r(e.timeout)&&e.timeout.then(t),g["legacy_"+e.method.toLowerCase()](e.url,e.data,n),s.promise}function l(t){g["legacy_"+t]=g[t],g[t]=function(n,r,u){var c=[f,void 0],a=i.when({url:o.urlPrefix+n,data:r,socket:g,config:u||{},method:t.toUpperCase()});for(e.forEach(p,function(e){(e.request||e.requestError)&&c.unshift(e.request,e.requestError),(e.response||e.responseError)&&c.push(e.response,e.responseError)});c.length;){var d=c.shift(),l=c.shift();a=a.then(d,l)}return a.success=function(e){return a.then(function(t){e(t.body,t.statusCode,s(t.headers),t)}),a},a.error=function(e){return a.then(null,function(t){e(t.body,t.statusCode,s(t.headers),t)}),a},a}}function h(t){(g[t]||g._raw[t])&&(g["legacy_"+t]=g[t]||g._raw[t],g[t]=function(o,n){null!==n&&e.isFunction(n)&&g["legacy_"+t](o,function(e){c.$evalAsync(n.bind(g,e))})})}var g;g=o.socket?o.socket:(t.sails&&t.sails.connect||t.connect)(o.url,o.config),g.connect=function(t){if(!g.isConnected()){var n=t||{};n=e.extend({},o.config,t),g.useCORSRouteToGetCookie=n.useCORSRouteToGetCookie,g.url=n.url||o.url,g.multiplex=n.multiplex,g._connect()}return g};var p=[];return e.forEach(n,function(t){p.unshift(e.isString(t)?u.get(t):u.invoke(t))}),e.forEach(o.httpVerbs,l),h(o.eventNames[0]),h(o.eventNames[1]),g.on("connect",function(){h(o.eventNames[2])}),g.$modelUpdater=function(t,o){g.on(t,function(t){var n;switch(t.verb){case"created":o.push(t.data);break;case"updated":var r;for(n=0;n<o.length;n++)if(o[n].id===t.id){r=o[n];break}if(!r&&!t.previous)return;r||(r=t.previous,o.push(r)),e.extend(r,t.data);break;case"destroyed":for(n=0;n<o.length;n++)if(o[n].id===t.id){o.splice(n,1);break}}})},g}],this.$get.$inject=["$q","$injector","$rootScope","$log","$timeout"]})}(e,t)}(angular,io);